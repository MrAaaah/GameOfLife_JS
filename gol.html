<!DOCTYPE html>
<html>
<head>
	<title>Game Of Life</title>
	
	<!-- ******** CSS ********-->
	<style>
		html, body {
  			width:  100%;
  			height: 100%;
  			margin: 0px;
  			background-color: black;
  			overflow: hidden;
		}

		
	</style>

	<!-- ******** JS ********-->
	<script type="text/javascript">
		document.addEventListener( "DOMContentLoaded", function(){    	
    		
    		var c = document.getElementById('canvas');
			//// resize
			c.width  = window.innerWidth;
			c.height = window.innerHeight;
    		var ctx = c.getContext("2d");
			
			//// Config
			var cell = {};
			cell.size = 10;
			cell.margin = 1;
			cell.colors = ["#0C0C0C", "#288FD7"];
			
			var nbX = parseInt(c.width / (cell.size + cell.margin));
			var nbY = parseInt(c.height / (cell.size + cell.margin));
			c.style.marginLeft = ((c.width - nbX*cell.size - (nbX-1)*cell.margin)/2) + 'px';
			c.style.marginTop = ((c.height - nbY*cell.size - (nbY-1)*cell.margin)/2) + 'px';
			
			var glidder = [
				[0, 1, 0, 0],
				[0, 0, 1],
				[1, 1, 1],
			];

			var diamond = [
				[0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0]
			];

			var weekender = [
				[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
				[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
				[1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
				[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
				[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
				[0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0],
				[0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0],
				[0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0]
			];

			function mod(a, b) {
				return (a + b) % b;
			}

			//// Buffers declaration (double)
			// + 1 padding top|bottom to duplicate opposite row (not displayed) 
			// 	=> no more needs of module func
			var buffer1 = new Array(); 		
			var buffer2 = new Array();
			for (var j = 0; j < nbY + 2; j++) { 
				buffer1[j] = new Array(); 	
				buffer2[j] = new Array();
			}

			var curBuffer = buffer1;
			var bakBuffer = buffer2;

			//// Some Funcs
			function enableCell(buffer, x, y) {
				buffer[y+1][x+1] = 1;

				// replication into opposite padding
				if (x == 0) {
					buffer[y+1][nbX+1] = 1;
				} else if (x == nbX-1) {
					buffer[y+1][0] = 1;
				}

				if (y == 0) {
					buffer[nbY+1][x+1] = 1;
				} else if (y == nbY-1) {
					buffer[0][x+1] = 1;
				}
			}

			function disableCell(buffer, x, y) {
				buffer[y+1][x+1] = 0;

				if (x == 0) {
					buffer[y+1][nbX+1] = 0;
				} else if (x == nbX-1) {
					buffer[y+1][0] = 0;
				}

				if (y == 0) {
					buffer[nbY+1][x+1] = 0;
				} else if (y == nbY-1) {
					buffer[0][x+1] = 0;
				}
			}

			function getCellState(buffer, x, y) {
				return buffer[y+1][x+1];
			}

			function clearBuffer(buffer) {
				for (var j = 0; j < nbY; j++) {
					for (var i = 0; i < nbX; i++) {
						disableCell(buffer, i, j);
					}
				}
			}

			function randomBuffer(buffer) {
				for (var j = 0; j < nbY; j++) {
					for (var i = 0; i < nbX; i++) {
						if (Math.floor((Math.random()*2))) {
							disableCell(buffer, i, j);
						} else {
							enableCell(buffer, i, j);
						}
					}
				}
			}			

			function swapBuffers(){
				if (curBuffer == buffer1) {
					curBuffer = buffer2;
					bakBuffer = buffer1;
				} else {
					curBuffer = buffer1;
					bakBuffer = buffer2;
				}
			};

			function draw() {
				for (var j = 0; j < nbY; j++) {
					for (var i = 0; i < nbX; i++) {
						ctx.fillStyle = cell.colors[getCellState(curBuffer, i, j)];
						ctx.fillRect(i*(cell.size + cell.margin), j*(cell.size + cell.margin), cell.size, cell.size);
					}
				}
			}

			function drawShip(x, y, ship) {
				for (var j = 0; j < ship.length; j++) {
					for (var i = 0; i < ship[j].length; i++) {
						if (ship[j][i]) {
							enableCell(curBuffer, (x+i) % nbX, (y+j) % nbY);
						};
					}
				}
			}

			function nbOfAliveNeighbours(x, y) {
				var sum = 0;
				for (var j = -1; j <= 1; j++) {
					for (var i = -1; i <= 1; i++) {
						if (i != 0 || j != 0) {
							if (getCellState(curBuffer, mod(x+i, nbX), mod(y+j, nbY)) != 0) {
								sum++;
							}
						}
					}
				}
				return sum;
			}

			function processNextGeneration() {
				for (var j = 0; j < nbY; j++) {
					for (var i = 0; i < nbX; i++) {
						var n = nbOfAliveNeighbours(i, j);
						var nextState = 0;
						var curState = getCellState(curBuffer, i, j);

						if (curState == 0 && n == 3
						  || curState == 1 && (n == 2 || n == 3)) {
							nextState = 1;
						}

						if (nextState == 1) {
							enableCell(bakBuffer, i, j);
						} else {
							disableCell(bakBuffer, i, j);
						}
					}
				}
				swapBuffers();
			}


			//// Fun
			clearBuffer(curBuffer);
			drawShip(30, 15, glidder);
			// drawShip(30, 15, diamond);
			// randomBuffer(curBuffer);
			// drawShip(28, 14, weekender);
			// drawShip(60, 25, diamond);
			// drawShip(28, 14, weekender);

			function update() {
			  	draw();
			  	processNextGeneration();
			}
			
			setInterval ( update, 50 );

			

    	}, false );
	</script>

</head>
<body>
<canvas id="canvas"></canvas>
</body>
</html>