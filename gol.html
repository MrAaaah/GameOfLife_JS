<!DOCTYPE html>
<html>
<head>
	<title>Game Of Life</title>
	
	<!-- ******** CSS ********-->
	<style>
		html, body {
  			width:  100%;
  			height: 100%;
  			margin: 0px;
  			background-color: black;
  			overflow: hidden;
		}

		
	</style>

	<!-- ******** JS ********-->
	<script type="text/javascript">
		document.addEventListener( "DOMContentLoaded", function(){    	
    		
    		var c = document.getElementById('canvas');
			//// resize
			c.width  = window.innerWidth;
			c.height = window.innerHeight;
    		var ctx = c.getContext("2d");
			
			//// Config
			var cell = {};
			cell.size = 100;
			cell.margin = 1;
			cell.colors = ["#0C0C0C", "#288FD7"];
			
			var nbX = parseInt(c.width / (cell.size + cell.margin));
			var nbY = parseInt(c.height / (cell.size + cell.margin));
			c.style.marginLeft = ((c.width - nbX*cell.size - (nbX-1)*cell.margin)/2) + 'px';
			c.style.marginTop = ((c.height - nbY*cell.size - (nbY-1)*cell.margin)/2) + 'px';
			
			var glidder = [
				[0, 1, 0],
				[0, 0, 1],
				[1, 1, 1],
			];

			var diamond = [
				[0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0]
			];

			var weekender = [
				[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
				[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
				[1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
				[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
				[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
				[0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0],
				[0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0],
				[0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0]
			];

			//// Buffers declaration (double)
			// + 1 padding top|bottom to duplicate opposite row (not displayed) 
			// 	=> no more needs of module func
			// * * * * * *
			// * o o o o *
			// * o o o o *
			// * o o o o *
			// * o o o o *
			// * * * * * *
			// we need to bind cells padding's references to grid border
			// * * * * * *  =>  a b c d a b
			// * o o o o *  =>  e f g h e f
			// * o o o o *  =>  i j o o i j
			// * o o o o *  =>  k l o o k l
			// * o o o o *  =>  a b c d a b
			// * * * * * *  =>  e f g h e f
			var buffer1 = new Array(); 		
			var buffer2 = new Array();

			function initBuffer(buffer) {
				for (var j = 0; j < nbY + 2; j++) { 
					buffer[j] = new Array(); 	

					if (j == nbY) {							// second to last row <=> first row
						buffer[j] = buffer[0];
					} else if (j == nbY + 1) {				// last row <=> second row 
						buffer[j] = buffer[1];
					} else {
						for (var i = 0; i < nbX + 2; i++) {
							if (i == nbX) {						// second to last col <=> first col
								buffer[j][i] = buffer[j][0];
							} else if (i == nbX + 1) { 			// last col <=> second col
								buffer[j][i] = buffer[j][1];
							} else {
								buffer[j][i] = { "s": 0, "nbN": 0};							
							}
						}
					}
				}	
			}
			
			initBuffer(buffer1);
			initBuffer(buffer2);

			var curBuffer = buffer1;
			var bakBuffer = buffer2;
			
			//// Some Funcs
			function setCell(buffer, x, y, val) {
				buffer[y+1][x+1]["s"] = val;
			}

			function enableCell(buffer, x, y) {
				setCell(buffer, x, y, 1);
			}

			function disableCell(buffer, x, y) {
				setCell(buffer, x, y, 0);
			}

			function getCellState(buffer, x, y) {
				return buffer[y+1][x+1]["s"];
			}

			function clearBuffer(buffer) {
				for (var j = 0; j < nbY; j++) {
					for (var i = 0; i < nbX; i++) {
						buffer[j+1][i+1]["s"] = 0;
						buffer[j+1][i+1]["nbN"] = 0;
					}
				}
			}

			function randomBuffer(buffer) {
				for (var j = 0; j < nbY; j++) {
					for (var i = 0; i < nbX; i++) {
						if (Math.floor((Math.random()*2))) {
							disableCell(buffer, i, j);
						} else {
							enableCell(buffer, i, j);
						}
					}
				}
			}			

			function swapBuffers(){
				if (curBuffer == buffer1) {
					curBuffer = buffer2;
					bakBuffer = buffer1;
				} else {
					curBuffer = buffer1;
					bakBuffer = buffer2;
				}
			};

			function draw() {
				for (var j = 0; j < nbY; j++) {
					for (var i = 0; i < nbX; i++) {
						ctx.fillStyle = cell.colors[getCellState(curBuffer, i, j)];
						ctx.fillRect(i*(cell.size + cell.margin), j*(cell.size + cell.margin), cell.size, cell.size);
					}
				}
			}

			function drawShip(x, y, ship) {
				for (var j = 0; j < ship.length; j++) {
					for (var i = 0; i < ship[j].length; i++) {
						if (ship[j][i]) {
							enableCell(curBuffer, (x+i) % nbX, (y+j) % nbY);
						};
					}
				}
			}

			function nbOfAliveNeighbours(x, y) {
				var sum = 0;
				for (var j = -1; j <= 1; j++) {
					for (var i = -1; i <= 1; i++) {
						if (i != 0 || j != 0) {
							if (getCellState(curBuffer, x+i, y+j) != 0) {
								sum++;
							}
						}
					}
				}
				return sum;
			}

			function processNextGeneration() {
				for (var j = 0; j < nbY; j++) {
					for (var i = 0; i < nbX; i++) {
						var n = nbOfAliveNeighbours(i, j);
						var nextState = 0;
						var curState = getCellState(curBuffer, i, j);

						if (curState == 0 && n == 3
						  || curState == 1 && (n == 2 || n == 3)) {
							nextState = 1;
						}

						if (nextState == 1) {
							enableCell(bakBuffer, i, j);
						} else {
							disableCell(bakBuffer, i, j);
						}
					}
				}
				swapBuffers();
			}


			//// Fun
			drawShip(1, 1, glidder);
			// drawShip(30, 15, diamond);
			// randomBuffer(curBuffer);
			// drawShip(28, 14, weekender);
			// drawShip(60, 25, diamond);
			// drawShip(28, 14, weekender);
			var n = 0;
			function update() {
			  	draw();
			  	processNextGeneration();
			  	n++;
			}
			
			setInterval ( update, 50 );

			

    	}, false );
	</script>

</head>
<body>
<canvas id="canvas"></canvas>
</body>
</html>